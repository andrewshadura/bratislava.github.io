"use strict";(self.webpackChunkbratislava_github_io=self.webpackChunkbratislava_github_io||[]).push([[6727],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>g});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=a.createContext({}),c=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=c(e.components);return a.createElement(p.Provider,{value:t},e.children)},s={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,p=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),d=c(n),g=r,m=d["".concat(p,".").concat(g)]||d[g]||s[g]||i;return n?a.createElement(m,o(o({ref:t},u),{},{components:n})):a.createElement(m,o({ref:t},u))}));function g(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=d;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var c=2;c<i;c++)o[c]=n[c];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},1858:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>o,default:()=>s,frontMatter:()=>i,metadata:()=>l,toc:()=>c});var a=n(7462),r=(n(7294),n(3905));const i={},o="Debugging k8s cluster connectivity to an outside service",l={unversionedId:"recipes/debug-cluster-connectivity",id:"recipes/debug-cluster-connectivity",title:"Debugging k8s cluster connectivity to an outside service",description:"To debug running pods in kubernetes you can follow official guide - https://kubernetes.io/docs/tasks/debug/debug-application/debug-running-pod/.",source:"@site/docs/recipes/debug-cluster-connectivity.md",sourceDirName:"recipes",slug:"/recipes/debug-cluster-connectivity",permalink:"/docs/recipes/debug-cluster-connectivity",draft:!1,editUrl:"https://github.com/bratislava/bratislava.github.io/edit/master/docs/recipes/debug-cluster-connectivity.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Connecting to Kubernetes",permalink:"/docs/recipes/connecting-to-kubernetes"},next:{title:"Docker setup",permalink:"/docs/recipes/docker-setup"}},p={},c=[],u={toc:c};function s(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"debugging-k8s-cluster-connectivity-to-an-outside-service"},"Debugging k8s cluster connectivity to an outside service"),(0,r.kt)("p",null,"To debug running pods in kubernetes you can follow official guide - ",(0,r.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/tasks/debug/debug-application/debug-running-pod/"},"https://kubernetes.io/docs/tasks/debug/debug-application/debug-running-pod/"),".",(0,r.kt)("br",{parentName:"p"}),"\n","Following is just a small example in our local context. Let's assume you want to check if you can ping a service from the ",(0,r.kt)("inlineCode",{parentName:"p"},"next-city-library")," pod."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("h3",{parentName:"li",id:"connect-to-proper-kubernetes-cluster"},"Connect to proper Kubernetes cluster"),(0,r.kt)("p",{parentName:"li"},"In our case, we will connect to ",(0,r.kt)("inlineCode",{parentName:"p"},"tkg-innov-dev"),". You can follow our ",(0,r.kt)("a",{parentName:"p",href:"/docs/recipes/kubernetes-lens-setup"},"Login guide"),".\nTo verify that you are correctly connected you can run"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl config current-context\n")),(0,r.kt)("p",{parentName:"li"},"The output should match ",(0,r.kt)("inlineCode",{parentName:"p"},"tkg-innov-dev"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("h3",{parentName:"li",id:"check-if-your-service-is-running-in-a-pod"},"Check if your service is running in a pod."),(0,r.kt)("p",{parentName:"li"},"Run"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get pods --all-namespaces\n")),(0,r.kt)("p",{parentName:"li"},"and find your desired pod and copy its name like: ",(0,r.kt)("inlineCode",{parentName:"p"},"next-city-library-app-b868fcd5c-lj6tb"),".",(0,r.kt)("br",{parentName:"p"}),"\n","If you are running a reasonable ",(0,r.kt)("inlineCode",{parentName:"p"},"*nix")," shell, you can do"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'kubectl get pods --all-namespaces | grep "next-city-library"\n')),(0,r.kt)("p",{parentName:"li"},"which should help with finding your POD.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("h3",{parentName:"li",id:"create-a-new-debug-pod-with-ubuntu"},"Create a new debug pod with ubuntu"),(0,r.kt)("p",{parentName:"li"},"Now we will create a new debug pod with ubuntu, and we will attach the container to the pod so we can easily debug it.\nRun following command to create a new debug POD, which will be a exact copy of your original container (you can read more information in the official docs)"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl debug next-city-library-app-b868fcd5c-lj6to -it --namespace=bratislava-monorepo --image=ubuntu --share-processes --copy-to=next-city-library-app-debug\n")),(0,r.kt)("p",{parentName:"li"},"Don't forget to update the proper pod and ",(0,r.kt)("inlineCode",{parentName:"p"},"--copy-to")," to the name you want. Under ",(0,r.kt)("inlineCode",{parentName:"p"},"--copy-to"),", you will find the running pod. This command will also attach you to newly created POD.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("h3",{parentName:"li",id:"install-needed-debugging-utilities-for-ubuntu"},"Install needed debugging utilities for ubuntu"),(0,r.kt)("p",{parentName:"li"},"Before any installations run, you might need to run"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo apt update --yes\n")),(0,r.kt)("p",{parentName:"li"},"For debugging, you will probably need some networking tools. You can install it with these commands:"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"ping: ",(0,r.kt)("inlineCode",{parentName:"li"},"apt-get install iputils-ping")),(0,r.kt)("li",{parentName:"ul"},"nslookup: ",(0,r.kt)("inlineCode",{parentName:"li"},"apt-get install dnsutils")),(0,r.kt)("li",{parentName:"ul"},"wget: ",(0,r.kt)("inlineCode",{parentName:"li"},"apt install wget")),(0,r.kt)("li",{parentName:"ul"},"curl: ",(0,r.kt)("inlineCode",{parentName:"li"},"apt install curl")))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("h3",{parentName:"li",id:"clean-up"},"Clean Up"),(0,r.kt)("p",{parentName:"li"},"After you are done with debugging, please clean up after yourself and delete the pods that you have created and no longer need. For example you can delete our debug pod with following command"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl delete pod next-city-library-app-debug --namespace=bratislava-monorepo\n")))))}s.isMDXComponent=!0}}]);