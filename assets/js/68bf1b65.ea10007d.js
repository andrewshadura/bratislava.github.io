"use strict";(self.webpackChunkbratislava_github_io=self.webpackChunkbratislava_github_io||[]).push([[6469],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>m});var o=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=o.createContext({}),l=function(e){var t=o.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},c=function(e){var t=l(e.components);return o.createElement(p.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},u=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,p=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),u=l(n),m=r,k=u["".concat(p,".").concat(m)]||u[m]||d[m]||a;return n?o.createElement(k,s(s({ref:t},c),{},{components:n})):o.createElement(k,s({ref:t},c))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,s=new Array(a);s[0]=u;var i={};for(var p in t)hasOwnProperty.call(t,p)&&(i[p]=t[p]);i.originalType=e,i.mdxType="string"==typeof e?e:r,s[1]=i;for(var l=2;l<a;l++)s[l]=n[l];return o.createElement.apply(null,s)}return o.createElement.apply(null,n)}u.displayName="MDXCreateElement"},4894:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>s,default:()=>d,frontMatter:()=>a,metadata:()=>i,toc:()=>l});var o=n(7462),r=(n(7294),n(3905));const a={},s="OpenAPI",i={unversionedId:"nestjs/OpenAPI",id:"nestjs/OpenAPI",title:"OpenAPI",description:"Some of this is out-of-date / legacy from the projects being part of single monorepo",source:"@site/docs/nestjs/OpenAPI.md",sourceDirName:"nestjs",slug:"/nestjs/OpenAPI",permalink:"/docs/nestjs/OpenAPI",draft:!1,editUrl:"https://github.com/bratislava/bratislava.github.io/edit/master/docs/nestjs/OpenAPI.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Module",permalink:"/docs/nestjs/Module"},next:{title:"Prisma",permalink:"/docs/nestjs/Prisma"}},p={},l=[{value:"Decorators and introspection",id:"decorators-and-introspection",level:2},{value:"DTOs/Entities",id:"dtosentities",level:3},{value:"Controllers",id:"controllers",level:3},{value:"Markdown documentation",id:"markdown-documentation",level:2}],c={toc:l};function d(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,o.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"openapi"},"OpenAPI"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Some of this is out-of-date / legacy from the projects being part of single monorepo")),(0,r.kt)("p",null,"We are generating OpenAPI specification for all of our NestJS projects. To generate this specification we're using ",(0,r.kt)("a",{parentName:"p",href:"https://docs.nestjs.com/openapi/introduction"},"@nestjs/swagger")," package."),(0,r.kt)("h2",{id:"decorators-and-introspection"},"Decorators and introspection"),(0,r.kt)("p",null,"We're using typescript plugin for introspecting comments that we don't need to write decorators for classes and descriptions for methods. This allows for using same documentation for OpenAPI and jsdoc for IDE like VSCode."),(0,r.kt)("p",null,"This extension needs to be included in project.json:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  ...\n  "build": {\n    "executor": "@nrwl/node:build",\n    "outputs": ["{options.outputPath}"],\n    "options": {\n      ...\n      "tsPlugins": [\n        {\n          "name": "@nestjs/swagger/plugin",\n          "options": {\n            "introspectComments": true\n          }\n        }\n      ]\n    }\n  }\n}\n')),(0,r.kt)("h3",{id:"dtosentities"},"DTOs/Entities"),(0,r.kt)("p",null,"Interpolation happens in ",(0,r.kt)("em",{parentName:"p"},"*",".dto.ts")," and ",(0,r.kt)("em",{parentName:"p"},"*",".entity.ts")," (basic difference is dto is only for transfers, entity can be used internally, but it depends on internal standards)."),(0,r.kt)("p",null,"Every file with this name should contain a default exported Class. The properties of this class will be automatically included in OpenAPI specs even without decorators."),(0,r.kt)("p",null,"To add description and example, we can use jsdoc spec instead of decorators (description can contain markdown - see next chapter)."),(0,r.kt)("blockquote",null,(0,r.kt)("h4",{parentName:"blockquote",id:"userdtots"},(0,r.kt)("em",{parentName:"h4"},(0,r.kt)("strong",{parentName:"em"},"user.dto.ts"))),(0,r.kt)("pre",{parentName:"blockquote"},(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"export class User {\n  /**\n   * Name of user\n   * @example John\n   */\n  name: string;\n  email: string;\n}\n")),(0,r.kt)("p",{parentName:"blockquote"},"generates:"),(0,r.kt)("pre",{parentName:"blockquote"},(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"schemas:\n  User:\n    type: object\n    properties:\n      name:\n        type: string\n        description: Name of user\n        example: John\n      email:\n        type: string\n    required:\n      - name\n      - email\n")),(0,r.kt)("p",{parentName:"blockquote"},"and this is it displayed in swagger:\n",(0,r.kt)("img",{src:n(6007).Z,width:"345",height:"302"}))),(0,r.kt)("h3",{id:"controllers"},"Controllers"),(0,r.kt)("p",null,"Controllers also support some level of comment introspection. It unfortunately only works for method description. We can use comment before method decorator to include that description (supports markdown)."),(0,r.kt)("p",null,"For responses we need to include description in the decorator. It also supports markdown, but be aware that you don't want any extra whitespace (no indenting)."),(0,r.kt)("blockquote",null,(0,r.kt)("pre",{parentName:"blockquote"},(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"import { Controller, Get } from '@nestjs/common';\nimport { ApiResponse } from '@nestjs/swagger';\nimport { User } from './user.dto';\n\n@Controller()\nexport class AppController {\n  /**\n   * ## Gets user\n   * Some extra stuff\n   */\n  @Get()\n  @ApiResponse({\n    status: 200,\n    type: User,\n    description: `# Testing markdown response description\nReturns user on success\n`,\n  })\n  getData(): User {\n    return new User();\n  }\n}\n")),(0,r.kt)("p",{parentName:"blockquote"},"This produces following swagger\n",(0,r.kt)("img",{src:n(5169).Z,width:"1583",height:"908"}))),(0,r.kt)("h2",{id:"markdown-documentation"},"Markdown documentation"),(0,r.kt)("p",null,"As it was already mentioned, we can use markdown comments in model and method descriptions and markdown strings in response descriptions (and also global description)."),(0,r.kt)("p",null,"But with raw-loader and typescript types (files in ",(0,r.kt)("em",{parentName:"p"},"/config/")," need to be imported in project.json and tsconfig)"),(0,r.kt)("blockquote",null,(0,r.kt)("h4",{parentName:"blockquote",id:"projectjson"},(0,r.kt)("strong",{parentName:"h4"},(0,r.kt)("em",{parentName:"strong"},"project.json"))),(0,r.kt)("pre",{parentName:"blockquote"},(0,r.kt)("code",{parentName:"pre",className:"language-json"},'...\n"build": {\n  "executor": "@nrwl/node:build",\n  "outputs": ["{options.outputPath}"],\n  "options": {\n    ...\n    "webpackConfig": [\n      "config/raw-loader.webpack.js"\n    ]\n  }\n}\n')),(0,r.kt)("h4",{parentName:"blockquote",id:"tsconfigappjson"},(0,r.kt)("strong",{parentName:"h4"},(0,r.kt)("em",{parentName:"strong"},"tsconfig.app.json"))),(0,r.kt)("pre",{parentName:"blockquote"},(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  ...\n  "compilerOptions": {\n    ...\n    "types": ["node", "../../../config/raw-loader"]\n  }\n}\n'))),(0,r.kt)("p",null,"Then we can import markdown files directly using an import statement. This is useful mainly for the main documentation of the API (please have in mind that it has to be a single page). This allows to reuse the documentation that's written in our docs (imported as ",(0,r.kt)("strong",{parentName:"p"},"@bratislava/docs"),")."),(0,r.kt)("blockquote",null,(0,r.kt)("h4",{parentName:"blockquote",id:"testmd"},(0,r.kt)("strong",{parentName:"h4"},(0,r.kt)("em",{parentName:"strong"},"test.md"))),(0,r.kt)("pre",{parentName:"blockquote"},(0,r.kt)("code",{parentName:"pre",className:"language-markdown"},"## Test API\n\nTesting the markdown import\n\n> With blockquote\n\n```ts\nconst user = new User();\n```\n\n- This\n- _is_\n- **working**\n")),(0,r.kt)("p",{parentName:"blockquote"},"Importing the file like this:"),(0,r.kt)("pre",{parentName:"blockquote"},(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"import docs from '@bratislava/docs/apps/test.md';\n\nasync function bootstrap() {\n  const app = await NestFactory.create(AppModule);\n  const port = process.env.PORT || 3333;\n\n  const config = new DocumentBuilder()\n    .setTitle('Test')\n    .setDescription(docs)\n    .setVersion('1.0')\n    .build();\n...\n")),(0,r.kt)("p",{parentName:"blockquote"},"And it looks like following in Swagger UI\n",(0,r.kt)("img",{src:n(9287).Z,width:"1623",height:"673"}))))}d.isMDXComponent=!0},6007:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/2021-11-02-16-02-42-d4ad452c45666be340a613956f6032d0.png"},5169:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/2021-11-02-16-40-32-2d9a7947bc68a6cf2d1d225192487c4e.png"},9287:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/2021-11-02-16-42-31-23fc80e5052e3143e16659d7f59c3c57.png"}}]);