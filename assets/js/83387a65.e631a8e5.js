"use strict";(self.webpackChunkbratislava_github_io=self.webpackChunkbratislava_github_io||[]).push([[8824],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>m});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),p=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=p(e.components);return r.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),u=p(n),m=a,y=u["".concat(l,".").concat(m)]||u[m]||d[m]||i;return n?r.createElement(y,o(o({ref:t},c),{},{components:n})):r.createElement(y,o({ref:t},c))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,o[1]=s;for(var p=2;p<i;p++)o[p]=n[p];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}u.displayName="MDXCreateElement"},4302:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>s,toc:()=>p});var r=n(7462),a=(n(7294),n(3905));const i={sidebar_position:6},o="Domains",s={unversionedId:"deployment-and-infrastructure/kubernetes/Domains",id:"deployment-and-infrastructure/kubernetes/Domains",title:"Domains",description:"How set up an external domain on our Kubernetes?",source:"@site/docs/deployment-and-infrastructure/kubernetes/Domains.md",sourceDirName:"deployment-and-infrastructure/kubernetes",slug:"/deployment-and-infrastructure/kubernetes/Domains",permalink:"/docs/deployment-and-infrastructure/kubernetes/Domains",draft:!1,editUrl:"https://github.com/bratislava/bratislava.github.io/edit/master/docs/deployment-and-infrastructure/kubernetes/Domains.md",tags:[],version:"current",sidebarPosition:6,frontMatter:{sidebar_position:6},sidebar:"tutorialSidebar",previous:{title:"Connections",permalink:"/docs/deployment-and-infrastructure/kubernetes/Connections"},next:{title:"Debuging",permalink:"/docs/deployment-and-infrastructure/kubernetes/Debuging"}},l={},p=[{value:"How set up an external domain on our Kubernetes?",id:"how-set-up-an-external-domain-on-our-kubernetes",level:2}],c={toc:p};function d(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,r.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"domains"},"Domains"),(0,a.kt)("h2",{id:"how-set-up-an-external-domain-on-our-kubernetes"},"How set up an external domain on our Kubernetes?"),(0,a.kt)("p",null,"Let's assume you want the domain ",(0,a.kt)("inlineCode",{parentName:"p"},"mestskakniznica.sk")," pointing to our production ",(0,a.kt)("inlineCode",{parentName:"p"},"nest-city-library.bratislava.sk"),". There are a few steps that need to be taken."),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("h3",{parentName:"li",id:"allow-new-url-in-internal-dns"},"Allow new URL in internal DNS"),"It would help if you told our city IT department to allow a new URL in the internal DNS system so that Kubernetes can create a Let's Encrypt certificate. The contact person for that is Filip Kra\u010d\xed. Write him on Teams."),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("h3",{parentName:"li",id:"prepare-new-url-in-code"},"Prepare new URL in code."),"In ",(0,a.kt)("inlineCode",{parentName:"li"},"Bratislava-monorepo"),", you can find file ",(0,a.kt)("inlineCode",{parentName:"li"},"urls.env")," where the new URL/domain needs to ne added. In our case, it will be ",(0,a.kt)("inlineCode",{parentName:"li"},"URL_NEXT_CITY_LIBRARY=mestskakniznica.sk")," This will tel the pipelines to create a kustomize file with an updated URL for this app."),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("h3",{parentName:"li",id:"add-dummy-commit"},"Add dummy commit"),"To propagate changes from ",(0,a.kt)("inlineCode",{parentName:"li"},"urls.env")," to your app, you need to add a dummy commit with some changes. Pipelines are checking what has changed, and if nothing changes inside the app, nothing is also deployed. So in our case we added some empty line in ",(0,a.kt)("inlineCode",{parentName:"li"},"/apps/next/city-library/readme.md"),". This forced pipelines to recreate the kustomize file."),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("h3",{parentName:"li",id:"create-pr-and-deploy-it"},"Create PR and deploy it"),"Merge new changes and deploy them until staging. When everything is ok, then deploy it also to production."),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("h3",{parentName:"li",id:"check-the-production-version"},"Check the production version"),"After deployment, check if production is working correctly and generate a certificate. If not, check if the URL is correct, or contact Filip."),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("h3",{parentName:"li",id:"optional-add-support-for-www"},"(Optional) Add support for www"),"If your project needs a ",(0,a.kt)("inlineCode",{parentName:"li"},"www")," prefix, you need to adapt the ingress yaml file accordingly. Note: Certificates will be generated automatically.",(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"spec:\n  tls:\n    - hosts:\n        - mestskakniznica.sk\n        - www.mestskakniznica.sk\n      secretName: next-city-library-tls\n  rules:\n    - host: mestskakniznica.sk\n      http:\n        paths:\n          - path: /\n            pathType: ImplementationSpecific\n            backend:\n              service:\n                name: next-city-library-app\n                port:\n                  number: 80\n    - host: www.mestskakniznica.sk\n      http:\n        paths:\n          - path: /\n            pathType: ImplementationSpecific\n            backend:\n              service:\n                name: next-city-library-app\n                port:\n                  number: 80\n")))))}d.isMDXComponent=!0}}]);